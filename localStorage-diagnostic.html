<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ­Øµ localStorage - Ù†Ø¸Ø§Ù… Ù‡Ø§Ø¦Ù„ Ø³Ø¹ÙŠØ¯ Ø£Ù†Ø¹Ù…</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #fff;
            margin: 0;
            padding: 20px;
            direction: rtl;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #f1c40f;
            padding-bottom: 20px;
        }
        .status-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #f1c40f;
        }
        .key-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }
        .exists { color: #2ecc71; }
        .missing { color: #e74c3c; }
        .data-preview {
            background: #2c3e50;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .refresh-btn {
            background: linear-gradient(135deg, #f1c40f 0%, #e67e22 100%);
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px 5px;
        }
        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(241, 196, 15, 0.4);
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-box {
            background: rgba(52, 152, 219, 0.2);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #f1c40f;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” ÙØ­Øµ localStorage - Ù†Ø¸Ø§Ù… Ù‡Ø§Ø¦Ù„ Ø³Ø¹ÙŠØ¯ Ø£Ù†Ø¹Ù…</h1>
            <p>ØªØ´Ø®ÙŠØµ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</p>
        </div>

        <div class="stats" id="stats">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ù€ JavaScript -->
        </div>

        <div class="status-card">
            <h3>ğŸ”‘ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù…Ù‡Ù…Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…:</h3>
            <div id="important-keys">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ù€ JavaScript -->
            </div>
        </div>

        <div class="status-card">
            <h3>ğŸ“¦ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø© (HSA Final Unified Storage):</h3>
            <div id="unified-data">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ù€ JavaScript -->
            </div>
        </div>

        <div class="status-card">
            <h3>ğŸ—‚ï¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©:</h3>
            <div id="all-keys">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ù€ JavaScript -->
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="refresh-btn" onclick="checkLocalStorage()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ­Øµ</button>
            <button class="refresh-btn" onclick="clearOldData()">ğŸ§¹ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</button>
            <button class="refresh-btn" onclick="exportData()">ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>
    </div>

    <script>
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function checkLocalStorage() {
            console.log('ğŸ” Ø¨Ø¯Ø¡ ÙØ­Øµ localStorage...');
            
            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©
            const keys = Object.keys(localStorage);
            let totalSize = 0;
            keys.forEach(key => {
                totalSize += (localStorage.getItem(key) || '').length;
            });

            // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            document.getElementById('stats').innerHTML = `
                <div class="stat-box">
                    <div class="stat-number">${keys.length}</div>
                    <div>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙØ§ØªÙŠØ­</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">${formatBytes(totalSize)}</div>
                    <div>Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">${((totalSize / 1024 / 1024) * 100 / 5).toFixed(1)}%</div>
                    <div>Ù…Ù† 5MB Ø§Ù„Ù…Ø³Ù…ÙˆØ­</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">âœ…</div>
                    <div>localStorage Ù†Ø´Ø·</div>
                </div>
            `;

            // Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù…Ù‡Ù…Ø©
            const importantKeys = [
                'token', 'auth_token',
                'user', 'user_data', 
                'hsa_final_unified_storage',
                'offlineData',
                'cached_templates',
                'dashboard-settings-updated',
                'hsa_emergency_backup',
                'unified_migration_complete'
            ];

            let importantKeysHtml = '';
            importantKeys.forEach(key => {
                const exists = localStorage.getItem(key) !== null;
                const size = exists ? (localStorage.getItem(key) || '').length : 0;
                const status = exists ? 'exists' : 'missing';
                const icon = exists ? 'âœ…' : 'âŒ';
                
                importantKeysHtml += `
                    <div class="key-item">
                        <span class="${status}">${icon} ${key}</span>
                        <span>${exists ? formatBytes(size) : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}</span>
                    </div>
                `;
            });
            document.getElementById('important-keys').innerHTML = importantKeysHtml;

            // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø©
            const unifiedData = localStorage.getItem('hsa_final_unified_storage');
            let unifiedHtml = '';
            
            if (unifiedData) {
                try {
                    const parsed = JSON.parse(unifiedData);
                    unifiedHtml = `
                        <div class="key-item">
                            <span class="exists">âœ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©</span>
                            <span>${formatBytes(unifiedData.length)}</span>
                        </div>
                        <div class="data-preview">
                            <strong>Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø©:</strong><br>
                            - Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${parsed.user ? 'âœ… Ù…ÙˆØ¬ÙˆØ¯' : 'âŒ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}<br>
                            - Ø§Ù„Ø´Ø±ÙƒØ§Øª: ${parsed.companies ? `${parsed.companies.length} Ø´Ø±ÙƒØ©` : 'âŒ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}<br>
                            - Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹: ${parsed.locations ? `${parsed.locations.length} Ù…ÙˆÙ‚Ø¹` : 'âŒ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}<br>
                            - Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©: ${parsed.evaluations ? `${parsed.evaluations.length} ØªÙ‚ÙŠÙŠÙ…` : 'âŒ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}<br>
                            - Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${parsed.lastUpdated || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
                            - Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©: ${parsed.syncStatus || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                        </div>
                    `;
                } catch (e) {
                    unifiedHtml = `
                        <div class="key-item">
                            <span class="missing">âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø©</span>
                            <span>${formatBytes(unifiedData.length)}</span>
                        </div>
                        <div class="data-preview">Ø®Ø·Ø£: ${e.message}</div>
                    `;
                }
            } else {
                unifiedHtml = `
                    <div class="key-item">
                        <span class="missing">âŒ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©</span>
                        <span>Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</span>
                    </div>
                `;
            }
            document.getElementById('unified-data').innerHTML = unifiedHtml;

            // Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙØ§ØªÙŠØ­
            let allKeysHtml = '';
            keys.sort().forEach(key => {
                const size = (localStorage.getItem(key) || '').length;
                allKeysHtml += `
                    <div class="key-item">
                        <span>${key}</span>
                        <span>${formatBytes(size)}</span>
                    </div>
                `;
            });
            document.getElementById('all-keys').innerHTML = allKeysHtml || '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙØ§ØªÙŠØ­ ÙÙŠ localStorage</p>';
        }

        function clearOldData() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©ØŸ Ù‡Ø°Ø§ Ù‚Ø¯ ÙŠØ­Ø°Ù Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¤Ù‚ØªØ©.')) {
                const oldKeys = ['old_user_data', 'legacy_settings', 'temp_data'];
                let cleared = 0;
                
                oldKeys.forEach(key => {
                    if (localStorage.getItem(key)) {
                        localStorage.removeItem(key);
                        cleared++;
                    }
                });
                
                alert(`ØªÙ… ØªÙ†Ø¸ÙŠÙ ${cleared} Ø¹Ù†ØµØ± Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©`);
                checkLocalStorage();
            }
        }

        function exportData() {
            const data = {};
            Object.keys(localStorage).forEach(key => {
                data[key] = localStorage.getItem(key);
            });
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `localStorage_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙØ­Øµ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', checkLocalStorage);
    </script>
</body>
</html>