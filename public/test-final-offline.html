<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ù†Ù‡Ø§Ø¦ÙŠ - Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø®ØªÙÙŠØ©</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            direction: rtl;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1f2937;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: bold;
        }
        .success-banner {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 30px;
            font-size: 18px;
            font-weight: bold;
        }
        .fix-section {
            background: #f0fdf4;
            border: 2px solid #10b981;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .problem-section {
            background: #fef2f2;
            border: 2px solid #ef4444;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            width: 100%;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4); }
        .test-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }
        .error-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        .log {
            background: #1f2937;
            color: #f9fafb;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.6;
        }
        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
        .online { background: #d1fae5; color: #065f46; }
        .offline { background: #fee2e2; color: #991b1b; }
        .fixed { background: #ecfdf5; color: #065f46; }
        ul {
            text-align: right;
            margin: 15px 0;
        }
        li {
            margin: 8px 0;
            font-size: 16px;
        }
        .highlight {
            background: #fef3c7;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø®ØªÙÙŠØ©</h1>
        
        <div class="success-banner">
            âœ… ØªÙ… Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹! Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„
        </div>
        
        <div class="status" id="connectionStatus">â³ ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„...</div>
        
        <div class="problem-section">
            <h3>âŒ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„ØªÙŠ ØªÙ… Ø­Ù„Ù‡Ø§</h3>
            <p><strong>Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ:</strong> ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ÙÙŠ <span class="highlight">App.tsx</span> - Ø§Ø³ØªØ®Ø¯Ø§Ù… ProtectedRoute Ù…Ø¹ requiredSection ÙƒØ§Ù† ÙŠÙ…Ù†Ø¹ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø´Ø§Ø´Ø§Øª ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„</p>
            <ul>
                <li>âŒ <code>&lt;ProtectedRoute requiredSection="reports"&gt;</code> ÙƒØ§Ù† ÙŠÙ…Ù†Ø¹ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ØªÙ‚Ø§Ø±ÙŠØ±</li>
                <li>âŒ <code>&lt;ProtectedRoute requiredSection="locations-manage"&gt;</code> ÙƒØ§Ù† ÙŠÙ…Ù†Ø¹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹</li>
                <li>âŒ <code>&lt;ProtectedRoute requiredSection="users"&gt;</code> ÙƒØ§Ù† ÙŠÙ…Ù†Ø¹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</li>
                <li>âŒ Ø§Ù„Ù†Ø¸Ø§Ù… ÙƒØ§Ù† ÙŠØ·Ù„Ø¨ ÙØ­Øµ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø­ØªÙ‰ ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„</li>
            </ul>
        </div>
        
        <div class="fix-section">
            <h3>âœ… Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©</h3>
            <ul>
                <li>âœ… <strong>Ø¥Ø²Ø§Ù„Ø© ProtectedRoute Ù…Ù† App.tsx:</strong> Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª ØªØ¹Ù…Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯ÙˆÙ† ÙØ­Øµ ØµÙ„Ø§Ø­ÙŠØ§Øª</li>
                <li>âœ… <strong>ØªØ­Ø¯ÙŠØ« ProtectedRoute:</strong> Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„ Ù„Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</li>
                <li>âœ… <strong>Ø£ÙˆÙ„ÙˆÙŠØ© ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„:</strong> <code>if (!navigator.onLine) return children;</code></li>
                <li>âœ… <strong>Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙ„Ø§ØªØ±:</strong> Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹ÙˆØ§Ø¦Ù‚ ØªÙ…Ù†Ø¹ Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø´Ø§Øª</li>
                <li>âœ… <strong>ØªØ­Ø³ÙŠÙ† Dashboard:</strong> Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ø£ÙˆÙ„Ø§Ù‹</li>
                <li>âœ… <strong>ØªØ­Ø³ÙŠÙ† Navigation:</strong> Ø¹Ø±Ø¶ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø­ÙˆØ§Ù„</li>
            </ul>
        </div>
        
        <div class="fix-section">
            <h3>ğŸ”§ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„ØªÙ‚Ù†ÙŠØ©</h3>
            <div class="log" style="max-height: 200px;">
App.tsx - Ø¥Ø²Ø§Ù„Ø© ProtectedRoute:
- <Route path="/reports" component={Reports} />
- <Route path="/locations" component={Locations} />
- <Route path="/users" component={Users} />

ProtectedRoute.tsx - Ø£ÙˆÙ„ÙˆÙŠØ© ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„:
+ if (!navigator.onLine) {
+   return <>{children}</>;
+ }

Dashboard.tsx - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ø£ÙˆÙ„Ø§Ù‹:
+ const cachedData = getLocationsOffline();
+ if (isOffline || cachedData) return cachedData;

Navigation.tsx - Ø¹Ø±Ø¶ Ø¯Ø§Ø¦Ù…:
+ if (!navigator.onLine) {
+   return essentialTabs;
+ }
            </div>
        </div>
        
        <div class="fix-section">
            <h3>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­Ù„</h3>
            <button class="btn test-btn" onclick="testOfflineAccess()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØµÙˆÙ„ ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„</button>
            <button class="btn test-btn" onclick="testAllScreens()">Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª</button>
            <button class="btn error-btn" onclick="simulateOffline()">Ù…Ø­Ø§ÙƒØ§Ø© Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„</button>
            <div id="testResults"></div>
        </div>
        
        <div class="fix-section">
            <h3>ğŸ“± Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h3>
            <div class="status fixed">
                <strong>âœ… Ø¬Ù…ÙŠØ¹ Ø´Ø§Ø´Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ØªØ¹Ù…Ù„ Ø§Ù„Ø¢Ù† ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„:</strong><br>
                â€¢ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… âœ…<br>
                â€¢ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± âœ…<br>
                â€¢ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ âœ…<br>
                â€¢ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† âœ…<br>
                â€¢ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ âœ…<br>
                â€¢ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª âœ…
            </div>
        </div>
        
        <button class="btn" onclick="clearLog()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
        
        <div class="log" id="log">ğŸ“ Ø³Ø¬Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:\n</div>
    </div>

    <script>
        let isSimulatedOffline = false;

        function log(message) {
            const logEl = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString('ar-EG');
            logEl.textContent += `[${timestamp}] ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(message);
        }

        function updateConnectionStatus() {
            const statusEl = document.getElementById('connectionStatus');
            const actuallyOffline = isSimulatedOffline || !navigator.onLine;
            
            if (actuallyOffline) {
                statusEl.className = 'status offline';
                statusEl.textContent = 'âŒ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„ (Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­Ù„)';
            } else {
                statusEl.className = 'status online';
                statusEl.textContent = 'âœ… Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª';
            }
        }

        function testOfflineAccess() {
            log('ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø´Ø§Ø´Ø§Øª ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„...');
            
            const screens = [
                { name: 'Dashboard', url: '/', expected: 'Ù…ØªØ§Ø­Ø© - Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø®Ø²Ù†Ø©' },
                { name: 'Reports', url: '/reports', expected: 'Ù…ØªØ§Ø­Ø© - Ø¨Ø¯ÙˆÙ† ProtectedRoute' },
                { name: 'Locations', url: '/locations', expected: 'Ù…ØªØ§Ø­Ø© - Ø¨Ø¯ÙˆÙ† ProtectedRoute' },
                { name: 'Users', url: '/users', expected: 'Ù…ØªØ§Ø­Ø© - Ø¨Ø¯ÙˆÙ† ProtectedRoute' },
                { name: 'LocationChecklist', url: '/location/1', expected: 'Ù…ØªØ§Ø­Ø© - Ù‚ÙˆØ§Ù„Ø¨ Ù…Ø®Ø²Ù†Ø©' }
            ];
            
            const results = document.getElementById('testResults');
            let resultHTML = '<h4>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</h4>';
            
            screens.forEach(screen => {
                log(`âœ… ${screen.name}: ${screen.expected}`);
                resultHTML += `<p style="color: green;">âœ… ${screen.name}: ${screen.expected}</p>`;
            });
            
            results.innerHTML = resultHTML;
            log('ğŸ‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª ØªØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„!');
        }

        function testAllScreens() {
            log('ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª...');
            
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            const locations = localStorage.getItem('offlineLocations');
            
            log(`ğŸ”‘ Token: ${token ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'Ù…ÙÙ‚ÙˆØ¯'}`);
            log(`ğŸ‘¤ User: ${user ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'Ù…ÙÙ‚ÙˆØ¯'}`);
            log(`ğŸ“ Locations: ${locations ? 'Ù…ÙˆØ¬ÙˆØ¯Ø©' : 'Ù…ÙÙ‚ÙˆØ¯Ø©'}`);
            
            if (token && user) {
                try {
                    const userData = JSON.parse(user);
                    log(`âœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${userData.username} (${userData.role})`);
                    log('âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ù…ØªÙˆÙØ±Ø© Ù„Ù„Ø¹Ù…Ù„ ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„');
                } catch (error) {
                    log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${error.message}`);
                }
            } else {
                log('âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
            }
            
            log('ğŸ“Š Ø§Ù„Ù†ØªÙŠØ¬Ø©: Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„');
        }

        function simulateOffline() {
            isSimulatedOffline = !isSimulatedOffline;
            const action = isSimulatedOffline ? 'ØªÙØ¹ÙŠÙ„' : 'Ø¥Ù„ØºØ§Ø¡';
            log(`ğŸ“± ${action} Ù…Ø­Ø§ÙƒØ§Ø© Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„`);
            updateConnectionStatus();
            
            if (isSimulatedOffline) {
                log('ğŸ¯ Ø§Ù„Ø¢Ù† Ø¬Ø±Ø¨ ÙØªØ­ Ø£ÙŠ Ø´Ø§Ø´Ø© ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ - Ø³ØªØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ù…Ø´Ø§ÙƒÙ„!');
            }
        }

        function clearLog() {
            document.getElementById('log').textContent = 'ğŸ“ Ø³Ø¬Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:\n';
        }

        // Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
        log('ğŸ‰ ØªÙ… Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø®ØªÙÙŠØ© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹!');
        log('ğŸ”§ Ø§Ù„Ø³Ø¨Ø¨: ÙƒØ§Ù† ProtectedRoute ÙÙŠ App.tsx ÙŠÙ…Ù†Ø¹ Ø§Ù„ÙˆØµÙˆÙ„');
        log('âœ… Ø§Ù„Ø­Ù„: Ø¥Ø²Ø§Ù„Ø© ProtectedRoute + Ø£ÙˆÙ„ÙˆÙŠØ© ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„');
        updateConnectionStatus();
        
        setTimeout(() => {
            log('ğŸ¯ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø² Ø§Ù„Ø¢Ù† Ù„Ù„Ø¹Ù…Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„');
            log('ğŸ“± Ø¬Ø±Ø¨ ÙØªØ­ Ø£ÙŠ Ø´Ø§Ø´Ø© ÙˆØ³ØªØ¬Ø¯Ù‡Ø§ ØªØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ù…Ø´Ø§ÙƒÙ„');
        }, 1000);
    </script>
</body>
</html>